<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üêâ Hip√≥lito, mi perro-drag√≥n - Cuento Interactivo</title>

    <style>
      /* ===== PORTADA PRINCIPAL ===== */
      body {
        font-family: "Comic Sans MS", "Trebuchet MS", cursive, sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
        background-image: url("assets/imagenes/portada principal sin logos.jpg");
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
        position: relative;
      }

      /* Contenedor de botones - posicionado abajo/medio a la izquierda */
      .botones-portada {
        position: absolute;
        bottom: 20%;
        left: 17%;
        display: flex;
        flex-direction: column;
        gap: 25px;
        z-index: 2;
        animation: aparecerBotones 1.5s ease-out;
      }

      @keyframes aparecerBotones {
        from {
          opacity: 0;
          transform: translateX(-50px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      /* Estilo de botones mejorado */
      .btn-portada {
        background: rgba(28, 38, 39, 0.85);
        border: solid 2px rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        padding: 18px 22px;
        font-size: 1.8rem;
        font-weight: bold;
        color: white;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        font-family: inherit;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        width: 75px;
        height: 75px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
      }

      .btn-portada:hover {
        transform: translateY(-5px);
        background: #344647;
      }

      .btn-portada:active {
        transform: translateY(-2px);
      }

      /* Bot√≥n de la maestra virtual */
      .btn-maestra {
        background: #b4a89c5d;
        border-color: #81797050;
      }

      .btn-maestra:hover {
        background: #c5b8ab;
      }

      /* Iconos de botones */
      .btn-icon {
        font-size: 1.8rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .botones-portada {
          left: 5%;
          bottom: 25%;
          gap: 25px;
        }

        .btn-portada {
          font-size: 1.4rem;
          padding: 18px 35px;
        }

        .btn-icon {
          font-size: 1.6rem;
        }
      }

      @media (max-width: 480px) {
        .botones-portada {
          left: 5%;
          bottom: 20%;
          gap: 20px;
        }

        .btn-portada {
          font-size: 1.2rem;
          padding: 15px 30px;
        }

        .btn-icon {
          font-size: 1.4rem;
        }
      }

      /* Animaci√≥n de entrada de botones */
      .btn-portada:nth-child(1) {
        animation: aparecerBoton 1s ease-out 0.5s both;
      }

      .btn-portada:nth-child(2) {
        animation: aparecerBoton 1s ease-out 0.7s both;
      }

      @keyframes aparecerBoton {
        from {
          opacity: 0;
          transform: translateX(-30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      /* ===== CHAT FLOTANTE (abajo a la derecha) ===== */
      .chat-launcher {
        position: fixed;
        right: 20px;
        bottom: 20px;
        width: 64px;
        height: 64px;
        border-radius: 50%;
        border: none;
        background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
        color: #fff;
        font-size: 28px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.25);
        cursor: pointer;
        z-index: 50;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .chat-launcher:hover { transform: translateY(-2px); box-shadow: 0 16px 28px rgba(0,0,0,.3); }

      .chat-widget {
        position: fixed;
        right: 20px;
        bottom: 100px;
        width: 480px;
        max-width: calc(100vw - 40px);
        height: 75vh;
        max-height: 720px;
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.35);
        display: none;
        flex-direction: column;
        overflow: hidden;
        z-index: 60;
        border: 2px solid #e8e8f8;
      }
      .chat-widget.abierto { display: flex; }

      .chat-header-mini {
        background: linear-gradient(135deg, #e17055 0%, #f39c12 100%);
        color: #fff;
        padding: 12px 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .chat-header-mini .titulo { display: flex; align-items: center; gap: 8px; font-weight: bold; }
      .chat-header-mini button.close-btn {
        background: transparent;
        border: none;
        color: #fff;
        font-size: 20px;
        cursor: pointer;
      }

  .estado-conexion { padding: 12px 14px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; display:flex; align-items:center; gap:8px; font-weight: bold; }
  .estado-conexion.exito { background: #d4edda; color: #155724; }

  #chat-mensajes {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
        background: #f8f9fa;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
  .mensaje { display: flex; gap: 12px; align-items: flex-start; }
      .mensaje.usuario { flex-direction: row-reverse; }
  .mensaje .avatar { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
  .mensaje.usuario .avatar { background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color:#fff; }
  .mensaje.profesora .avatar { background: linear-gradient(135deg, #e17055 0%, #f39c12 100%); color:#fff; }
  .mensaje .contenido { max-width: 75%; padding: 15px 18px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 2px solid transparent; background:#fff; }
  .mensaje.usuario .contenido { background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: #fff; border-color: #0984e3; }
  .mensaje.profesora .contenido { background: #fff; color:#2d3436; border-color: #e17055; }

      .chat-input-bar { display: flex; gap: 8px; padding: 10px; background: #fff; border-top: 2px solid #e9ecef; }
      #chat-input { flex: 1; min-height: 38px; max-height: 90px; resize: vertical; padding: 8px 10px; border: 2px solid #74b9ff; border-radius: 10px; font-family: inherit; font-size: 0.95rem; }
      #btn-enviar { width: 44px; height: 44px; border-radius: 50%; border: none; background: linear-gradient(135deg,#e17055 0%,#f39c12 100%); color:#fff; font-size:18px; cursor:pointer; }

  .controles-adicionales { padding: 10px; background: #f8f9fa; border-top: 1px solid #e9ecef; display:flex; gap:10px; justify-content: flex-end; }
  .btn-control { background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); border: none; color:#fff; border-radius: 18px; padding: 8px 12px; font-weight: 600; cursor: pointer; }

      /* Indicador escribiendo */
      .puntos-escribiendo { display:flex; gap:4px; margin-top:6px; }
      .puntos-escribiendo span { width:7px; height:7px; border-radius:50%; background: currentColor; animation: latir 1.4s ease-in-out infinite; }
      .puntos-escribiendo span:nth-child(2){ animation-delay:.25s }
      .puntos-escribiendo span:nth-child(3){ animation-delay:.5s }
      @keyframes latir { 0%,60%,100%{opacity:.3; transform:scale(.8)} 30%{opacity:1; transform:scale(1.15)} }

      @media (max-width: 480px) {
  .chat-widget { right: 10px; bottom: 90px; height: 65vh; width: calc(100vw - 20px); }
        .chat-launcher { right: 10px; bottom: 10px; }
      }
    </style>
  </head>
  <body>
    <!-- Solo botones, sin texto -->
    <div class="botones-portada">
      <a href="www/cuento-secuencial.html" class="btn-portada">
        <span class="btn-icon">üìñ</span>
      </a>

      <a href="#" id="abrir-chat" class="btn-portada btn-maestra" title="Abrir chat educativo">
        <span class="btn-icon">üë©‚Äçüè´</span>
      </a>
    </div>

    <!-- Lanzador de chat (estilo burbuja) -->
    <button id="chat-launcher" class="chat-launcher" aria-label="Abrir chat con Hip√≥lito" title="Chat con Hip√≥lito">üí¨</button>

    <!-- Chat flotante -->
    <section id="chat-widget" class="chat-widget" aria-label="Chat Educativo">
      <div class="chat-header-mini">
        <div class="titulo">ÔøΩ‚Äçüè´ <span>Profesora Virtual</span></div>
        <button class="close-btn" id="cerrar-chat" aria-label="Cerrar">‚úï</button>
      </div>
      <div id="estado-conexion" class="estado-conexion"><span class="icono">üîÑ</span><span class="texto">Preparando nuestra charla...</span></div>
      <div id="chat-mensajes"></div>
      <div class="chat-input-bar">
        <textarea id="chat-input" placeholder="Escribe tu mensaje‚Ä¶"></textarea>
        <button id="btn-enviar" aria-label="Enviar">‚û§</button>
      </div>
      <div class="controles-adicionales">
        <button class="btn-control" id="btn-nueva-sesion">üîÑ Nueva Conversaci√≥n</button>
      </div>
  </section>

    <!-- Reutilizamos el chat educativo -->
    <script src="www/js/profesora-virtual.js"></script>
    <script src="www/js/chat-educativo.js"></script>
    <script>
      (function () {
        let chatInstancia = null;
        const widget = document.getElementById('chat-widget');
        const abrirBtn = document.getElementById('abrir-chat');
        const launcher = document.getElementById('chat-launcher');
        const cerrarBtn = document.getElementById('cerrar-chat');

        function abrirChat() {
          if (!chatInstancia) {
            chatInstancia = new ChatEducativo();
            chatInstancia.inicializar().catch(console.error);
          }
          widget.classList.add('abierto');
        }

        function cerrarChat() {
          widget.classList.remove('abierto');
        }

        abrirBtn?.addEventListener('click', (e) => { e.preventDefault(); abrirChat(); });
        launcher?.addEventListener('click', abrirChat);
        cerrarBtn?.addEventListener('click', cerrarChat);

        // Cerrar con ESC
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') cerrarChat();
        });
      })();
    </script>
  </body>
</html>
